<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="cryptocurrencies, digital assets, crypto, bitcoin, ether, FF，tokenization，sto，stock，forex，token">
    <meta name="description" content="55 Global Markets’ mission is to facilitate the unrestricted flow of global assets circulation and asset via tokenization through the application of and blockchain technology. 55 Global Markets aims to reconstruct the conventional patterns of existing asset exchange models using tokens as transaction vehicles, making.">
    <meta id="i18n_pagename" content="index">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,user-scalable=no">
   <link rel="stylesheet" href="../static/web/iconfont/iconfont.css">
    <link rel="stylesheet" href="../static/web/styles/index.css">
    <link rel="stylesheet" href="../static/web/styles/header_footer.css?t=20180910">
    <link rel="stylesheet" href="../static/web/styles/page/pagination.css?t=20180724">
    <link rel="stylesheet" href="../static/web/styles/page_new/invitation.css?t=20180724">
    <link rel="stylesheet" media="screen and (max-width:768px)" href="../static/web/styles/page/phoneInvitation.css?t=20180724">
    <title class="i18n" name="yqzyHeaderTilte">invitation</title>
</head>

<body>
    <div class="wrapper">
            <div class="big-container">
                <div class="common-header"></div>
                <div class="nav">
                    <img src="../static/web/images_new/logo_new.png"/>
                    <div class="i18n" name="download"></div>
                    <div><a class="i18n" name="myInvitation" href="./invitationCode.html">My invitation</a></div>
                </div>
                <div class="invite_wrapper">
                    <div class="invite_content">
                        <div class="swiper-wrapper">
                            <div class="swiper-content">
                                <p name="yqzyImage1" class="i18n">Get 30% of fee as cashback</p>
                                <!--<p name="yqzyImage2" class="i18n">Invite your friends to register 55 and easily get-->
                                    <!--fee cashback</p>-->
                                <!--<p class="i18n" name="yqzyImage3"></p>-->
                                <img src="../static/web/images_new/banner1.png" class="invite-banner">
                                <div class="slogan horizontally-centered text-center">
                                    <h1 class="i18n" name="yqzyImage1"></h1>
                                    <!--<h2 class="i18n" name="yqzyImage2"></h2>-->
                                    <!--<h3 class="i18n" name="yqzyImage3"></h3>-->
                                </div>
                            </div>
                        </div>
                        <div class="invite-msg">
                            <div class="invite-msg-nav i18n" name="yqzyWaySharing">

                            </div>
                            <div class="invite-code-info">
                                <div class="invite-code-qrcode ml">
                                    <p class="i18n" name="yqzyCodePoster"></p>
                                    <div>
                                        <button type="button" class="invite-qrcode-button i18n" name="yqzyChoosePoster"></button>
                                    </div>
                                </div>
                                <div class="invite-code-copy ml">
                                    <p class="i18n codeDescription" name="yqzyExclusiveCode"></p>
                                    <div class="invitecode-content">
                                        <div class="fl">
                                            <input readonly="readonly" id="inviteCode" class="invite-code-input" type="text" name="" />
                                        </div>
                                        <button type="button" class="invite-code-copy-button i18n" data-clipboard-action="copy" data-clipboard-target="#inviteCode" name="yqzyCopyCode"></button>
                                        <button type="button" class="invite-code-copy-button invite-code-phone i18n" data-clipboard-action="copy" data-clipboard-target="#inviteCode" name="yqzyCopyCodePhone"></button>
                                    </div>
                                </div>
                                <div class="invite-link-copy ml">
                                    <p class="i18n linkdetail" name="yqzyRegistrationLink"></p>
                                    <div class="invitecode-content">
                                        <div class="fl">
                                            <input readonly="readonly" id="inviteLink" class="invite-link-input" type="text" />
                                        </div>
                                        <button type="button" class="invite-link-copy-button i18n" name="yqzyCopyLinkShare" data-clipboard-action="copy" data-clipboard-target="#inviteLink"></button>
                                        <button type="button" class="invite-link-copy-button invite-link-phone i18n" name="yqzyCopyCodePhone" data-clipboard-action="copy" data-clipboard-target="#inviteLink"></button>

                                    </div>
                                </div>
                            </div>
                            <button class="copy-success center-level dis-n" id="copy_success">
                                <i class="iconfont">&#xe69f;</i>
                                <span class="i18n" name='czSucceed'></span>
                            </button>
                        </div>

                        <div class="invite-msg invite-table-phone">

                            <div class="invite-table">
                                <table>
                                    <tr>
                                        <td class="invite-td1 i18n" name="yqzyInviteTotal"></td>
                                        <!--<td class="invite-td2 i18n" name="yqzyCashback"></td>-->
                                    </tr>
                                    <tr>
                                        <td ><em class="i18n" name="yqzyInviteTotalAll"> </em>
                                            <span class="invite-total"></span>
                                        </td>
                                        <!--<td>-->
                                            <!--<span  class="ffCode">FF</span>-->
                                            <!--<span class="cashback-total"></span>-->
                                        <!--</td>-->
                                    </tr>
                                </table>

                            </div>
                        </div>

                        <div class="invite-msg">
                            <div class="invite-msg-nav">
                                <ul class="tab">
                                    <li class="tab-item active i18n" name="yqzyInviteHistory">Invite History</li>
                                    <!-- <li class="tab-item">Cashback History</li> -->
                                </ul>
                                <!--<div class="fr">-->
                                    <!--<select>-->
                                        <!--<option value="" class="i18n" name="yqzyAllHistory"></option>-->
                                        <!--<option value="0" class="i18n" name="yqzyExpiredHistory"></option>-->
                                        <!--<option value="1" class="i18n" name="yqzyValidHistory"></option>-->
                                    <!--</select>-->
                                <!--</div>-->
                            </div>

                            <div id="invited_list_template"></div>
                            <div class="setPageDiv">
                                <div class="Pagination" id="pagination"></div>
                            </div>

                            <!--<div class="invite-msg">-->
                                <!--<div class="invite-msg-nav i18n" name="yqzyProgramDetails">-->
                                    <!--Program Details-->
                                <!--</div>-->
                                <!--<div class="i18n invite-msg-nav invite-msg-nav-phone" name="yqzyProgramDetails">-->
                                    <!--Program Details-->
                                <!--</div>-->
                                <!--<div class="invite-rulls">-->
                                    <!--<p class="i18n" name="yqzyDetails0"></p>-->

                                    <!--<p class="i18n" name="yqzyDetails1"></p>-->

                                    <!--<p class="i18n" name="yqzyDetails2"></p>-->

                                    <!--<p class="i18n" name="yqzyDetails3"></p>-->

                                    <!--&lt;!&ndash;<p class="i18n" name="yqzyDetails4"></p>&ndash;&gt;-->
                                    <!--&lt;!&ndash;<p class="i18n" name="yqzyDetails5"></p>&ndash;&gt;-->
                                    <!--<p class="i18n" name="yqzyDetails9"></p>-->
                                <!--</div>-->
                            <!--</div>-->
                        </div>

                    </div>
                    <div class="common-footer"></div>
                </div>
            </div>
            <div class="dialog_wrap dialog_poster dis-n">
            <div class="dialog">
                <div class="dia_title">
                    <div>
                        <b class="i18n" name="yqzyPosterTitle"></b>
                        <span class="close hb_icon_close" data-action="closePoster"></span>
                    </div>
                </div>
                <div class="dia_content">
                    <ul>
                        <li class="dia_img1" id="dia_img1">
                            <div id="canvas1">
                                <div id="img1" class="invite-poster">
                                    <img src="../static/web/images/poster1.png" height="280px" />
                                </div>
                                <div class="invite-qrcode1">
                                    <div class="invite-title">
                                        <p class="i18n" name="exInivitation">55EX Invitation program</p>
                                        <p class="p-font i18n" name="tojoin">invite you to join 55EX</p>
                                        <p class="p-font i18n" name="inviteqrcode">Long press to identify QR code</p>
                                    </div>

                                    <div id="qrcode1" class="qrcode"></div>
                                </div>


                            </div>


                            <a href="#" class="down_img" onclick="downloadPoster(1)"><em class="i18n" name="yqzyPosterDownload"></em></a>
                        </li>
                        <li class="dia_img2" id="dia_img2">
                            <div id="canvas2">
                                <div id="img2" class="invite-poster">
                                    <img src="../static/web/images/poster2.png" height="280px" />
                                </div>
                                <div class="invite-qrcode2">
                                    <div class="invite-title">
                                        <p class="i18n" name="exInivitation">55EX Invitation program</p>
                                        <p class="p-font i18n" name="tojoin">invite you to join 55EX</p>
                                        <p class="p-font i18n" name="inviteqrcode">Long press to identify QR code</p>
                                    </div>

                                    <div id="qrcode2" class="qrcode"></div>

                                </div>
                            </div>

                            <a href="#" class="down_img" onclick="downloadPoster(2)"><em class="i18n" name="yqzyPosterDownload"></em></a>
                        </li>
                        <li class="dia_img3" id="dia_img3">
                            <div id="canvas3">
                                <div id="img3" class="invite-poster">
                                    <img src="../static/web/images/poster3.png" height="280px" />
                                </div>
                                <div class="invite-qrcode3">
                                    <div class="invite-title">
                                        <p class="i18n" name="exInivitation">55EX Invitation program</p>
                                        <p class="p-font i18n" name="tojoin">invite you to join 55EX</p>
                                        <p class="p-font i18n" name="inviteqrcode">Long press to identify QR code</p>
                                    </div>
                                    <div id="qrcode3" class="qrcode"></div>
                                </div>
                            </div>

                            <a href="#" class="down_img" onclick="downloadPoster(3)"><em class="i18n" name="yqzyPosterDownload"></em></a>

                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</body>
<script type="text/javascript" src='../static/web/js/lib/jquery.min.js'></script>
<script type="text/javascript" src="../static/web/js/lib/clipboard.js"></script>
<script type="text/javascript" src="../static/web/js/page/plateformUrl.js"></script>
<script type="text/javascript" src='../static/web/js/page/jquery.pagination.js'></script>
<script type="text/javascript" src='../static/web/js/lib/handlebars-1.0.0.beta.6.js'></script>
<script type="text/javascript" src="../static/web/js/page/html2canvas.js"></script>
<script type="text/javascript" src="../static/web/js/lib/QRCode.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script type="text/javascript" src='../static/web/js/lib/jquery.i18n.properties.js?t=20180912'></script>
<script type="text/javascript" src='../static/web/js/lib/layer.js?t=20180912'></script>
<script type="text/javascript" src='../static/web/js/lib/language.js?t=20180912'></script>
<script type="text/javascript" src="../static/web/js/page/header.js?t=20180912"></script>
<!-- 构建模板 -->
<script id="invite-template" type="text/x-handlebars-template">
    <div class="account-content clearfix">
            <div class="table-box">
                <table class="invite-user-list" cellspacing=0>
                    <thead>
                        <tr class="tr-title">
                            <td class="i18n" name="invitdAccount">Invited Account</td>
                            <td class="i18n" name="invitDate">Date</td>
                            <!--<td class="i18n" name="inviteStatus">Status</td>-->
                         </tr>
                    </thead>

                   <tbody>
                    {{#each this}}
                    <tr>
                        <td>
                            <span class="">{{userName}}</span>
                        </td>
                        <td>
                            <span class="">{{formatDate createTime}}</span>
                        </td>
                        <!--<td>-->
                            <!--<span class="">{{formatstate inviteUserState}}</span>-->
                        <!--</td>-->
                    </tr>
                    {{/each}}
                   </tbody>

                </table>
            </div>
        </div>

</script>

<script type="text/javascript">
    $(document).ready(function () {

        var logintoken =  Cookies.get('loginToken');
        if(logintoken==''||logintoken==undefined){
            window.location.href='../exchange/b11/index.html#/login';
        }

       importHeaderFooter()
        labelName()
        navigation('nav9')
        sanCode()


        var Constants = {
            plateformShowUrl:  "/api/sso"
        }

        var api = {
            inviteCode: Constants.plateformShowUrl + "/invite/query.myInviteCode",
            invitedCount: Constants.plateformShowUrl + "/invite/query.usersCount",
            invitedList: Constants.plateformShowUrl + "/invite/query.userList",
        }


        // 调用接口获取邀请码
        sendGetRequest(api.inviteCode, function (data) {
            var inviteCode = data.userCode;
            var protocol = window.location.protocol;//协议
            var host = window.location.host;//主机名+端口号
            // var port = window.location.port;
            var targetUrl = protocol + "//" + host;
            var inviteLink = targetUrl + "/invitation/signUpInvitation.html?invite_code=" + inviteCode;
            $("#inviteCode").val(inviteCode);
            $("#inviteLink").val(inviteLink);

//            //生成二维码  勿删除
            var qrcode1 = new QRCode('qrcode1', {
                width: 200,
                height: 200
            });
            qrcode1.makeCode(inviteLink);

            var qrcode2 = new QRCode('qrcode2', {
                width: 200,
                height: 200
            });
            qrcode2.makeCode(inviteLink);

            var qrcode3 = new QRCode('qrcode3', {
                width: 200,
                height: 200
            });
            qrcode3.makeCode(inviteLink);

        })

        // 调用接口获取邀请人数
        sendGetRequest(api.invitedCount, function (data) {
            var total = data.count;
            var cashTotal =parseInt(30*total);
            if(cashTotal==null||cashTotal==undefined){
                cashTotal =0;
            }
            $('.cashback-total').text(cashTotal);
            $(".invite-total").text(total);
        })

        //点击切换tab
        $(".tab >li").click(function () {
            $(this).addClass("active").siblings().removeClass("active");
            //获取当前tab索引
            var index = $(this).index();
            //根据这个索引切换，下面的展示
            $(".main").eq(index).addClass("selected").siblings().removeClass("selected");
        })

        //抓取数据模板
        var theTemplateScript = $('#invite-template').html();
        //编译模板
        var theTemplate = Handlebars.compile(theTemplateScript);
        // 自定义助手，用以处理日期时间
        Handlebars.registerHelper('formatDate', function (datetime) {
            return timestampToTime(datetime);
        });
        // 自定义助手，用以处理状态
        var language = localStorage.getItem("countryLanguage");
        invitestatus(language)
        function invitestatus(language){
            Handlebars.registerHelper('formatstate', function (state) {
                if (language == 'en') {
                    if (state == 1) {
                        return "Valid";
                    } else {
                        return "Expired";
                    }
                } else if (language == 'zh-CN') {
                    if (state == 1) {
                        return "有效";
                    } else {
                        return "过期";
                    }
                }
            });
        }



        // 获取邀请列表
       // var inviteUserState = $("select").val();
        function PageCallback(page_index, jq) {
            var curNumber = page_index.getCurrent()
            var invitedList = api.invitedList + "?pageNum=" + curNumber + "&pageSize=10";
            sendGetRequest(invitedList, function (data) {
                var list = data.list;
                var theCompileHtml = theTemplate(list);
                $('#invited_list_template').html(theCompileHtml);
                layerInternational()


            })
        }
        $('.reload').click(function () {//改变语言
            var value = $(this).attr('data-value');
            invitestatus(value)
            reloadTable()
        });
        reloadTable()
    function reloadTable(){
        var invitedList = api.invitedList + "?pageNum=1&pageSize=10"
        sendGetRequest(invitedList, function (data) {
            if (!data.code) {
                var list = data.list;
                var total = data.pages;
                var allTotal = data.total;
                var theCompileHtml = theTemplate(list);
                $('#invited_list_template').html(theCompileHtml);
                layerInternational()
                var paginationHide = false;
                if (allTotal > 10) {
                    paginationHide = false;
                }else{
                    paginationHide = true;

                }
                $('#pagination').pagination({
                    pageCount: total,
                    callback: PageCallback,
                    prev_text: '<',
                    next_text: '>',
                    items_per_page: 10,
                    num_edge_entries: 2,
                    num_display_entries: 10,
                    current_page: 0,
                    mode: 'fixed',
                    isHide: paginationHide,
                    keepShowPN: true,
                })
            }else {
                var code = data.code;
                if(code==10013){
                    layer.msg('<div class="i18n" name="AuthorizationRefuse">登录已失效</div>',{
                        time:1500,
                        end:function(){
                            Cookies.remove('loginToken',{domain:document.domain.split('.').slice(-2).join('.')});
                            localStorage.removeItem("curPage");
                            window.location.href='../exchange/b11/index.html#/login'
                        }
                    })
                }



            }
        })
    }



        function timestampToTime(timestamp) {
            var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
            Y = date.getFullYear() + '-';
            M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
            D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate()) + ' ';
            h = (date.getHours() < 10 ? '0' + (date.getHours()) : date.getHours()) + ':';
            m = (date.getMinutes() < 10 ? '0' + (date.getMinutes()) : date.getMinutes()) + ':';
            s = (date.getSeconds() < 10 ? '0' + (date.getSeconds()) : date.getSeconds());
            return Y + M + D + h + m + s;
        }




        // 根据邀请状态值，获取邀请列表55whitepaper_zh
        $("select").change(function () {
            var invitedList = api.invitedList + "?pageNum=1&pageSize=10&inviteUserState=" + $(this).val();
            sendGetRequest(invitedList, function (data) {
                if (!data.code) {
                    var list = data.list;
                    var total = data.pages;
                    var allTotal = data.total;
                    var theCompileHtml = theTemplate(list);
                    $('#invited_list_template').html(theCompileHtml);
                    layerInternational()
                    var paginationHide = false;
                    if (allTotal >10) {
                        paginationHide = false;
                    }else{
                        paginationHide = true;
                    }
                    $('#pagination').pagination({
                        pageCount: total,
                        callback: PageCallback,
                        prev_text: '<',
                        next_text: '>',
                        items_per_page: 10,
                        num_edge_entries: 2,
                        num_display_entries: 10,
                        current_page: 0,
                        mode: 'fixed',
                        isHide: paginationHide,
                        keepShowPN: true,
                    })
                }
            })
        })

        // 计数，只第一次打开的时候进行canvas转换
        var canvasNum = 0;
        $(".invite-qrcode-button").click(function () {
            $(".dialog_poster").removeClass("dis-n");
            if (canvasNum <= 0) {
                var dia1 = document.getElementById("dia_img1");
                var canvasContent1 = document.getElementById("canvas1");
                var dia2 = document.getElementById("dia_img2");
                var canvasContent2 = document.getElementById("canvas2");
                var dia3 = document.getElementById("dia_img3");
                var canvasContent3 = document.getElementById("canvas3");
                html2Canvas(dia1, canvasContent1);
                html2Canvas(dia2, canvasContent2);
                html2Canvas(dia3, canvasContent3);
                canvasNum++;
                layerInternational()
            }
            layerInternational()
        })

        // 关闭海报展示的dialog
        $(".hb_icon_close").click(function () {
            $(".dialog_poster").addClass("dis-n");
        })

    })

    //复制邀请链接到剪切板
    var clipboard = new Clipboard('.invite-link-copy-button');
    clipboard.on('success', function () {
        $("#copy_success").fadeIn(0).fadeOut(1500);
    });

    //复制邀请码到剪切板
    var clipboard = new Clipboard('.invite-code-copy-button');
    clipboard.on('success', function () {
        $("#copy_success").fadeIn(0).fadeOut(1500);
    });

    // 将html转换成canvas
    function html2Canvas(html, canvasContent) {
        // 设置canvas参数，使转成的图像实际尺寸为展示图像的三倍，以此保证下载的图像清晰度
        var width = html.offsetWidth;
        var height = html.offsetHeight;
        var canvas = document.createElement("canvas");
        var scale = 3;

        canvas.width = width * scale;
        canvas.height = height * scale;
        canvas.getContext("2d").scale(scale, scale);

        var opts = {
            scale: scale,
            canvas: canvas,
            logging: true,
            width: width,
            height: height
        };
        html2canvas(canvasContent, opts).then(function (canvas) {
            html.insertBefore(canvas, html.childNodes[0]);
            html.removeChild(canvasContent);
            layerInternational()
        });
        layerInternational()

    }

    /**
     * 在本地进行文件保存
     * @param  {String} data     要保存到本地的图片数据
     * @param  {String} filename 文件名
     */
    function saveFile(data, filename) {
        var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
        save_link.href = data;
        save_link.download = filename;

        var event = document.createEvent('MouseEvents');
        event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        save_link.dispatchEvent(event);
    };

    function downloadPoster(index) {
        var canvas = document.getElementById('dia_img' + index).firstChild;

        // 图片导出为 png 格式
        var type = 'png';
        var imgData = canvas.toDataURL(type);
        // 获取mimeType
        var _fixType = function (type) {
            type = type.toLowerCase().replace(/jpg/i, 'jpeg');
            var r = type.match(/png|jpeg|bmp|gif/)[0];
            return 'image/' + r;
        };

        // 加工image data，替换mime type
        imgData = imgData.replace(_fixType(type), 'image/octet-stream');
        // 下载后的图片名
        var filename = 'poster' + index + '.png';
        // 下载到本地
        saveFile(imgData, filename);
    }


</script>

</html>