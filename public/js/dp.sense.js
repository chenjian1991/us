!function(global,factory){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("Geetest requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){"use strict";function _Object(obj){this._obj=obj}function Config(config){var self=this;new _Object(config)._each(function(key,value){self[key]=value})}function PureEvent(){this._events={}}if(void 0===window)throw new Error("Geetest requires browser environment");var document=window.document,Math=window.Math,head=document.getElementsByTagName("head")[0];_Object.prototype={_each:function(process){var _obj=this._obj;for(var k in _obj)_obj.hasOwnProperty(k)&&process(k,_obj[k]);return this}},Config.prototype={api_server:"api.geetest.com",type_path:"/gettype_deepknow.php",protocol:"http://",static_servers:["static.geetest.com","dn-staticdown.qbox.me"],path:"/static/js/sense.js",type:"sense",_extend:function(obj){var self=this;new _Object(obj)._each(function(key,value){self[key]=value})}};var isNumber=function(value){return"number"==typeof value},isString=function(value){return"string"==typeof value},isBoolean=function(value){return"boolean"==typeof value},isFunction=function(value){return"function"==typeof value},random=function(){return parseInt(1e4*Math.random())+(new Date).valueOf()},loadScript=function(url,cb){var script=document.createElement("script");script.charset="UTF-8",script.async=!0,script.onerror=function(){cb(!0)};var loaded=!1;script.onload=script.onreadystatechange=function(){loaded||script.readyState&&"loaded"!==script.readyState&&"complete"!==script.readyState||(loaded=!0,setTimeout(function(){cb(!1)},0))},script.src=url,head.appendChild(script)},normalizeDomain=function(domain){return domain.replace(/^https?:\/\/|\/$/g,"")},normalizePath=function(path){return path=path.replace(/\/+/g,"/"),0!==path.indexOf("/")&&(path="/"+path),path},normalizeQuery=function(query){if(!query)return"";var q="?";return new _Object(query)._each(function(key,value){(isString(value)||isNumber(value)||isBoolean(value))&&(q=q+encodeURIComponent(key)+"="+encodeURIComponent(value)+"&")}),"?"===q&&(q=""),q.replace(/&$/,"")},makeURL=function(protocol,domain,path,query){domain=normalizeDomain(domain);var url=normalizePath(path)+normalizeQuery(query);return domain&&(url=protocol+domain+url),url},load=function(protocol,domains,path,query,cb){var tryRequest=function(at){var url=makeURL(protocol,domains[at],path,query);loadScript(url,function(err){err?at>=domains.length-1?cb(!0):tryRequest(at+1):cb(!1)})};tryRequest(0)},jsonp=function(domains,path,config,callback){var cb="geetest_"+random();window[cb]=function(data){callback("success"===data.status?data.data:data),window[cb]=undefined;try{delete window[cb]}catch(e){}},load(config.protocol,domains,path,{gt:config.id,callback:cb},function(err){err&&throwError("networkError",config)})},throwError=function(errorType,config){var errors={networkError:"网络错误",idNotExist:"参数id必填",cbIlegal:"callback必须是function",geetestNotExist:"Geetest不存在"};if("function"!=typeof config.onError)throw new Error(errors[errorType]);config.onError(errors[errorType])},detect=function(type){return type=type||"sense",!!window.Geetest&&window.Geetest[type]},senseObj=null,event={},loadSense=function(callback,error){var config=new Config;if("http:"!==window.location.protocol&&"https:"!==window.location.protocol?config.protocol="https://":config.protocol=window.location.protocol+"//",config.id="sense id",detect())return senseObj=new window.Geetest(config),void(isFunction(callback)&&callback());jsonp([config.api_server],config.type_path,config,function(newConfig){load(config.protocol,newConfig.static_servers,newConfig.path,null,function(err){if(err)throwError("networkError",config),isFunction(error)&&error({code:"2000",msg:"网络错误"});else{if("undefined"==typeof window.Geetest)return throwError("geetestNotExist",config),void(isFunction(error)&&error({code:"2001",msg:"sense对象未加载成功"}));config._extend(newConfig),senseObj=new window.Geetest(config),senseObj.onClose(function(){event._emitEvent("close")}),isFunction(callback)&&callback()}})})};loadSense();var senseJudge=function(obj,callback,error){if(senseObj){if(!obj||!obj.id)return void("function"==typeof error&&error({code:"2002",msg:"sense id 必填"}));senseObj.setConfig(obj),obj.interactive?senseObj.setInfos(function(){return{interactive:obj.interactive}}):senseObj.setInfos(null),senseObj.onSuccess(function(data){"function"==typeof callback&&callback(data)}).onError(function(e){"function"==typeof error&&error(e)}),senseObj.sense()}else isFunction(error)&&error({code:"2001",msg:"sense对象未加载成功"})},destroySense=function(){senseObj&&senseObj.destroy()};PureEvent.prototype={_addEvent:function(type,cb){var self=this;return self._events[type]?self._events[type].push(cb):self._events[type]=[cb],self},_emitEvent:function(type,msg){var self=this,cbs=self._events[type];if(cbs){for(var i=0,len=cbs.length;i<len;i+=1)cbs[i](msg);return self}},_destroy:function(){this._events={}}};var event=new PureEvent,onClose=function(cb){event._destroy(),event._addEvent("close",function(){cb()},!1)};return window.Sense={judge:senseJudge,load:loadSense,destroy:destroySense,onClose:onClose},Sense});