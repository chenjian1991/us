<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="">
    <meta name="description" content="">
    <meta id="i18n_pagename" content="index">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="../static/web/styles/page/intlTelInput.css?t=20180912">
    <link rel="stylesheet" href="../static/web/styles/page/demo.css?t=20180912">
    <link rel="stylesheet" href="../static/web/styles/index.css?t=20180912">
     <link rel="stylesheet" href="../static/web/styles/header_footer.css?t=20180910">
    <link rel="stylesheet" href="../static/web/iconfont/iconfont.css?t=20180912">
    
    <link rel="stylesheet" href="../static/web/styles/page/securityCenter.css?t=20180912">
	<title class="i18n" name="setpassword">set password</title>
</head>
<body>
<div class="wrapper">
    <div class="big-container">
    <div class="common-header"></div>
<div class="phone_wrapper container">
	<div class="phone_content content">
        <a class="phone_nav i18n" name="jymmAccountSecurity" href="../exchange/b11/index.html#/safeCenter">Acount & Security</a>
        <a class="i18n jymmSetTPassword" name="jymmSetTPassword" href="javascript:;">>Set Trading Password</a>
        <a class="i18n jymmChangeTPassword" name="jymmChangeTPassword" href="javascript:;">>Set Trading Password</a>
        <div class="phone_title i18n" name="jymmExplain">*For security purposes no withdrawals are permitted for 24 hours after modification of security methods.</div>
        <div class="phone-msg">
            <div name="jymmSetTPassword" class="phone-msg-nav i18n jymmSetTPassword">Set Trading Password</div>
            <div name="jymmChangeTPassword" class="phone-msg-nav i18n jymmChangeTPassword">Change Trading Password</div>

            <div class="trade-title clearfix">
                <div class="fl txt-center">
                    <p class="trade-step trade-after">1</p>
                    <p class="i18n step-p1" name="jymmStep1">Security verification</p>
                </div>
                <div class="fl txt-center ">
                    <p class="trade-step trade-gray">2</p>
                    <p class="i18n step-p2 jymmSetTPassword" name="jymmSetTPassword">Set the trading password</p>
                    <p class="i18n step-p2 jymmChangeTPassword" name="jymmChangeTPassword">Set the trading password</p>
                </div>
            </div>
            <div class="phone-input-group trading-password-grop">
            <form id="setPassword">
                <ul class="trading-content-one">
                    <li class="phone-li-item">
                        <span class="phone-span-item  i18n" name="jymmLoginPassword"></span><input type="password" name="loginPass" minlength="8" maxlength='20'>
                    </li>
                    <!--  发送手机验证码 -->
                    <li class="phone-li-item phoneItem">
                       <span class="phone-span-item smsPhone"></span><input autocomplete="off" onkeyup="value=value.replace(/[^\d]/g,'')" class="smsCode" type="text" name="SMSCode" minlength="6" maxlength='6'><button onclick="sendMessage()" type="button" id="btnSendCode" class="phone-sms i18n" name="jymmSendSMS"></button>
                    </li>
                    <!-- 邮箱发送验证码 -->
                    <li class="phone-li-item emailItem">
                        <span class="phone-span-item emailCode"></span><input autocomplete="off" onkeyup="value=value.replace(/[^\d]/g,'')" class="smsCode" type="text" name="EmailCode" minlength="6" maxlength='6'><button onclick="sendEmaiCode()" type="button" id="btnSendEmailCode" class="phone-sms i18n" name="zhmmSend"></button>
                     </li>
                    <li class="phone-li-item google-li">
                        <span class="phone-span-item i18n" name="ggyzGoogleAuthenticationCode"></span><input autocomplete="off" type="text" name="googleCode" minlength="6" maxlength='6'>
                    </li>
                    <li class="phone-li-item trading-next-step">
                        <button type="button" name="jymmNext"  class="phone-submit i18n" id="tradingNext"></button>
                        <button style="display: none;" id="languagetwo-change" type="button"></button>
                    </li>
                </ul>
            </form>
            <form id="tradingPass">
                <ul class="trading-content-two">
                    <li class="phone-li-item">
                        <span  class="phone-span-item i18n" name="jymmTradingPassword"></span><input id="firstPass" class="i18n-input" selectattr="placeholder"  selectname="tradingPasswordWord" onkeyup="value=value.replace(/[^\d]/g,'')"  type="password" minlength="6" maxlength='6' name="tradingPass">
                    </li>
                    <li class="phone-li-item">
                        <span onkeyup="value=value.replace(/[^\d]/g,'')" class="phone-span-item i18n" name="jymmConfirmPassword"></span><input class="i18n-input" selectattr="placeholder"  selectname="tradingPasswordWord" onkeyup="value=value.replace(/[^\d]/g,'')" type="password" name="confirmPass" minlength="6" maxlength='6'>
                    </li>
                    <li class="phone-li-item trading-next-step">
                        <button type="button" class="phone-submit i18n" name="jymmSubmit"></button>
                        <button style="display: none;" id="language-change" type="button"></button>
                    </li>
                </ul>
            </form>
        </div> 
        </div>
    </div>

</div>
<div class="common-footer"></div>
</div>
</div>
</body>
<script type="text/javascript" src='../static/web/js/lib/jquery.min.js?t=20180912'></script>
<script type="text/javascript" src="../static/web/js/page/plateformUrl.js?t=20180912"></script>
<script type="text/javascript" src="../static/web/js/lib/jquery-validation-1.7.0.js?t=20180912"></script>
<script type="text/javascript" src='../static/web/js/lib/layer.js?t=20180912'></script>
<script type="text/javascript" src='../static/web/js/page/common_validate.js?t=20180912'></script>
<script type="text/javascript" src='../static/web/js/lib/jquery.i18n.properties.js?t=20180912'></script>
 <script type="text/javascript" src='../static/web/js/lib/language.js?t=20180912'></script>
<script type="text/javascript" src="../static/web/js/page/dealFooter.js?t=20180912"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script type="text/javascript" src="../static/web/js/page/header.js?t=20180912"></script>


<script type="text/javascript">
   var setTradingPasswordFlag = localStorage.getItem('isSetTradePasswrod')
    if(setTradingPasswordFlag==true||setTradingPasswordFlag=='true'){
        $('.jymmSetTPassword').hide()
    }else{
        $('.jymmChangeTPassword').hide()
    }
   $(document).ready(function () {
             importHeaderFooter('nav9')
             labelName()
             navigation('nav9')
             sanCode()

   })


//查询用户信息
        sendPostRequestByJsonObj(api.getUserInfo, {}, function (data) {
            if (data != undefined) {
                var data = data;
                layerInternational();
                var securityLevel = data.securityLevel;
                var isSetTradePasswrod = data.isSetTradePasswrod;
                var code = data.code;
                var loginEx55Pin = data.ex55Pin;
                var securitPhone = data.phone;
                var googleNumber = data.isBindingGoogle;
                var emailFlag = data.email;
                localStorage.setItem('ifEmail',emailFlag);
                localStorage.setItem('ifsetgoogle',googleNumber);
                localStorage.setItem('loginEx55Pin', loginEx55Pin);
                localStorage.setItem('securitPhone', securitPhone);
                localStorage.setItem('isSetTradePasswrod',isSetTradePasswrod)

                    var ifsetgoogle = localStorage.getItem('ifsetgoogle');
                    if(ifsetgoogle=="true"||ifsetgoogle==true){
                        $('.google-li').show();
                    }else {
                        $('.google-li').hide();
                    }

                
                var ifBandingEmail = localStorage.getItem('ifEmail');
                    if(ifBandingEmail=='null'||ifBandingEmail==null){//没有绑定邮箱
                        $('.emailItem').hide()
                    }else{
                        $('.emailItem').show()
                        $('.emailCode').html("<span style='margin-right:5px;' class='i18n' name='jymmEmailCode'></span>"+""+ifBandingEmail+"<span></span>")
                    }

                    var userphone = localStorage.getItem('securitPhone')
                    $('.smsPhone').html("<span class='i18n' name='jymmSMSCode'></span>"+userphone+"<span></span>")
                    if(userphone=='null'||userphone==null){//没有绑定手机
                        $('.phoneItem').hide()
                    }else{
                        $('.phoneItem').show();
                    }






                if (code == 10013) {
                    layer.msg('<div class="i18n" name="AuthorizationRefuse">登录已失效</div>',{
                        time:1500,
                        end:function(){
                            localStorage.removeItem('loginToken')
                            window.location.href='../exchange/b11/index.html#/login'
                        }
                    })
                    layerInternational();
                }
         
                if (isSetTradePasswrod == true) {
                    $('.security-bottom ul li span em').css('background', 'url(../static/web/img/ywc@2x.png) no-repeat center center');
                    $('.modifyPassword').show();
                    $('.setTrad').hide();

                } else {
                    $('.modifyPassword').hide();
                    $('.setTrad').show();
                }
                if (securitPhone != '') {
                    $('.security-table-iphone').css('background', 'url(../static/web/img/ywc@2x.png) no-repeat center center');
                }

                if(googleNumber){
                    $('.security-table-goole').css('background', 'url(../static/web/img/ywc@2x.png) no-repeat center center');
                    $('.closegoogle').show()
                    $('.opengoogle').hide()
                }else{
                    $('.security-table-goole').css('background', 'url(../static/web/img/ts@2x.png) no-repeat center center')
                    $('.closegoogle').hide()
                    $('.opengoogle').show()
                }


            }
        });


   
 

         /*发送验证码*/
        var InterValObj; //timer变量，控制时间 
        var InterValObjEmail;//email  控制时间
        var count = 60; //间隔函数，1秒执行 
        var curCount;//当前剩余秒数 
        function sendMessage(){
            var loginPassword = $('input[name="loginPass"]').val().trim().replace(/\s/g,'')
            if(loginPassword==''){
                layer.msg('<div class="i18n" name="Inputpassword"></div>')
                layerInternational()
                return
            }
 
         　curCount = count; 
        　　//设置button效果，开始计时 
           $("#btnSendCode").attr("disabled", "true"); 
           $("#btnSendCode").text(curCount + "s"); 
            $('#btnSendCode').addClass('gray')
             InterValObj = window.setInterval(SetRemainTimePhone, 1000);
            var data = {
             "codeType":"PHONE",
             "operateType":"SET_TRADE_PASSWORD"
            }
            $.ajax({
                url:api.tradeSend,
                type:'post',
                data:JSON.stringify(data),
                dataType:'json',
                headers: {
                "Content-Type": "application/json;charset=UTF-8",
                "token":    Cookies.get('loginToken')
                },
                success:function(data){
                    var code = data.code;
                    if(code==10021){
                        layer.msg('<div class="i18n" name="Verification"></div>')
                        layerInternational()
                        window.clearInterval(InterValObj);//停止计时器


                    }else if(code==10038){
                        layer.msg('<div class="i18n" name="verificationinvalid">验证码发送无效，请重新发送</div>');
                        layerInternational()
                        window.clearInterval(InterValObj);//停止计时器
                    }else if(code ==10013){
                                layer.msg('<div class="i18n" name="AuthorizationRefuse"></div>');
                                layerInternational()
                                Cookies.remove('loginToken',{domain:document.domain.split('.').slice(-2).join('.')});
                                localStorage.removeItem("curPage");
                                window.location.href='../exchange/b11/index.html#/login'
                                return false;
                    }


                },
                error:function(XMLHttpRequest, textStatus, errorThrown){
                    if(XMLHttpRequest.status==500){

                          
                    }
                   
                }
            })
        } 

        function sendEmaiCode(){
            var loginPassword = $('input[name="loginPass"]').val().trim().replace(/\s/g,'')
            if(loginPassword==''){
                layer.msg('<div class="i18n" name="Inputpassword"></div>')
                layerInternational()
                return
            }
 
         　curCount = count; 
        　　//设置button效果，开始计时 
           $("#btnSendEmailCode").attr("disabled", "true"); 
           $("#btnSendEmailCode").text(curCount + "s"); 
            $('#btnSendEmailCode').addClass('gray')
            InterValObjEmail = window.setInterval(SetRemainTimeEmail, 1000);
            var data = {
             "codeType":"EMAIL",
             "operateType":"SET_TRADE_PASSWORD",
             "language":localStorage.getItem('countryLanguage')
            }
            $.ajax({
                url:api.tradeSend,
                type:'post',
                data:JSON.stringify(data),
                dataType:'json',
                headers: {
                "Content-Type": "application/json;charset=UTF-8",
                "token": Cookies.get('loginToken')
                },
                success:function(data){
                    var code = data.code;
                    if(code==10021){
                        layer.msg('<div class="i18n" name="Verification"></div>')
                        layerInternational()
                        window.clearInterval(InterValObjEmail);//停止计时器


                    }else if(code==10038){
                        layer.msg('<div class="i18n" name="verificationinvalid">验证码发送无效，请重新发送</div>');
                        layerInternational()
                        window.clearInterval(InterValObjEmail);//停止计时器
                    }else if(code ==10013){
                                layer.msg('<div class="i18n" name="AuthorizationRefuse"></div>');
                                layerInternational()
                                Cookies.remove('loginToken',{domain:document.domain.split('.').slice(-2).join('.')});
                                localStorage.removeItem("curPage");
                                window.location.href='../exchange/b11/index.html#/login'
                                return false;
                    }


                },
                error:function(XMLHttpRequest, textStatus, errorThrown){
                    if(XMLHttpRequest.status==500){

                          
                    }
                   
                }
            })



        }
        //timer处理函数 
        function SetRemainTimePhone() {
            if (curCount == 0) {
                window.clearInterval(InterValObj);//停止计时器
                $("#btnSendCode").removeAttr("disabled");//启用按钮 
                $('#btnSendCode').removeClass('gray')
                //$("#btnSendCode").html("retry");
                 $("#btnSendCode").attr('name','reaginSendtwo');
                layerInternational()

            }
              else {
                curCount--; 
                $("#btnSendCode").text(curCount + "s"); 
              } 
        } 


           function SetRemainTimeEmail() {
            if (curCount == 0) {
                window.clearInterval(InterValObjEmail);//停止计时器
                $("#btnSendEmailCode").removeAttr("disabled");//启用按钮 
                $('#btnSendEmailCode').removeClass('gray')
                //$("#btnSendCode").html("retry");
                 $("#btnSendEmailCode").attr('name','reaginSendtwo');
                layerInternational()

            }
              else {
                curCount--; 
                $("#btnSendEmailCode").text(curCount + "s"); 
              } 
        } 

            
$('#language-change').click(function(){
    $('#setPassword').valid()
})

    
    var ifBandingEmail = localStorage.getItem('ifEmail');
    var userphone = localStorage.getItem('securitPhone')
            
        //下一步点击事件
          $('#tradingNext').click(function(){//下一步点击事件,验证验证码
            if($('#setPassword').valid()){
            var phoneData = {
                  "password":$('input[name="loginPass"]').val().trim().replace(/\s/g,''),
                  "phoneCode":$('input[name="SMSCode"]').val().trim().replace(/\s/g,''),
                  "emailCode":$('input[name="EmailCode"]').val().trim().replace(/\s/g,''),
                 "googleCode":$('input[name="googleCode"]').val().trim().replace(/\s/g,''),

            }
            sendPostRequestByJsonObj(api.TradingPasswordVerifynew,phoneData,function(data,xhr,textStatus){
                if(textStatus.status==200){
                    var code = data.code;
                    var token = data.token;
                    localStorage.setItem('Token',token);
                    if(code == 10007){
                          layer.msg('<div class="i18n" name="passwordNotCorrect"></div>')
                         layerInternational()
                    }else if(code ==10003){
                        layer.msg('<div class="i18n" name="SMSNotCorrect"></div>')
                         layerInternational()
                    }else if(code ==10010){
                        layer.msg('<div class="i18n" name="passwordNotwright"></div>')
                         layerInternational()
                    }else if(code==10025){
                        layer.msg('<div class="i18n" name="googleNotwright"></div>')
                        layerInternational()
                    }else if(code==10023){
                        layer.msg('<div class="i18n" name="paramError"></div>')
                        layerInternational()
                    }else if(code==10035||code==10027){
                        layer.msg('<div class="i18n" name="emailCodeError"></div>')
                        layerInternational()
                    }else if(code==403){
                        layer.msg('<div class="i18n" name="illegalRequest"></div>')
                        layerInternational()
                    }else{  //验证成功
                            localStorage.setItem('curPage',1)
                            $('.trading-content-one').hide();
                            $('.trading-content-two').show();
                            $('.trade-step').removeClass('trade-after').addClass('trade-before');
                            $('.trade-gray').addClass('trade-highlight');
                      
                    }
                }
                })

        }
        
    })


    //刷新后仍然停留在本页面；
    var curPage = localStorage.getItem('curPage')?localStorage.getItem('curPage'):0;
    if(curPage==1){
        $('#setPassword .trading-content-one').hide();
        $('#tradingPass .trading-content-two').show();
        $('.trade-step').removeClass('trade-after').addClass('trade-before');
        $('.trade-gray').addClass('trade-highlight');
    }else if(curPage==0){
        $('#setPassword .trading-content-one').show();
        $('#tradingPass .trading-content-two').hide();
    }


   $('#languagetwo-change').click(function(){
       $('#tradingPass').valid()
   })


    $('#tradingPass .phone-submit').click(function(){//*submit设置交易密码*/
        $('#tradingPass').valid()
        if($('#tradingPass').valid()){
                var data = {
                        "password":$('input[name="confirmPass"]').val().trim().replace(/\s/g,''),
                        "ex55Pin":localStorage.getItem('loginEx55Pin'),
                        }
            $.ajax({
                url:api.setTradingPassword,
                type:'post',
                headers: {
                    "Content-Type": "application/json;charset=UTF-8",
                    "token": localStorage.getItem('Token'),
                },
                data:JSON.stringify(data),
                dataType:'json',
                success:function(data,xhr,textStatus){
                //弹窗的国际化实现
                    //layer.msg('<div class="i18n" name="aleryRegister"></div>')
                    //必须写在layer.msg之后，因为只有渲染完成之后才可以获取到class='i18n'
                    //公共的layer国际化方法
                    if(textStatus.status==200){
                        if(data!=undefined){
                            var code = data.code;
                            if(code == 10013){
                                layer.msg('<div class="i18n" name="AuthorizationRefuse"></div>');
                                layerInternational()
                                Cookies.remove('loginToken',{domain:document.domain.split('.').slice(-2).join('.')});
                                localStorage.removeItem("curPage");
                                window.location.href='../exchange/b11/index.html#/login'
                                return false;
                            }else if(code ==10011){
                                layer.msg('<div class="i18n" name="passwordMust"></div>');
                                layerInternational()
                                return false;
                            }else if(code ==10017){
                                layer.msg('<div class="i18n" name="moreSixTimes"></div>');
                                layerInternational()
                                return false;
                            }else if(code ==10000){
                                layer.msg('<div class="i18n" name="systemBusy"></div>');
                                layerInternational()
                                return false;
                            }else if(code ==10023){
                                layer.msg('<div class="i18n" name="AuthorizationRefuse"></div>');
                                layerInternational()
                                return false;
                            }
                        }
                        localStorage.setItem('tradingPasswordFlag',true);
                        layer.msg('<div class="i18n" name="setTradingPass">success</div>',{
                                        time:1500,
                                        end:function(){
                                            window.location.href = '../exchange/b11/index.html#/safeCenter';
                                            
                                        }


                    })

                        layerInternational()
                    }
                    

                }
                
            })
            

    


}
    

})

</script>
</html>
